function OrderCloudSDKBuyerXP(e){e.decorator("OrderCloudSDK",["$delegate","$resource","$q","blobstorageurl","bachmansIntegrationsUrl",function(e,r,n,t,a){return e.Buyers.Get=function(){return r(t+"/buyerxp.json",{},{call:{method:"GET",cache:!1,responseType:"json"}}).call().$promise.then(function(e){return{xp:e}})},e.Buyers.List=function(){return e.Buyers.Get().then(function(e){return{Items:[e],Meta:{Page:1,PageSize:1,TotalPages:1,TotalCount:1,ItemRange:[1,1]}}})},e.Buyers.Update=function(){var t=[].slice.call(arguments)[1],o=e.GetToken();return t&&t.xp?r(a+"/api/webdata/buyerxp",null,{call:{method:"PUT",headers:{Authorization:"Bearer "+o}}}).call(t.xp).$promise.then(function(){return e.Buyers.Get()}):n.reject("Missing body")},e.Buyers.Patch=function(){return n.reject("Use Buyers.Update instead")},e}])}function bachAssignments(e,r,n){function t(t){return r(e+"/assignments/usergroup",{},{call:{method:"POST",headers:{"oc-token":n.GetToken()}}}).call(t).$promise}var a={UserGroup:t};return a}function bachGiftCards(e,r,n,t,a){function o(e){return l().create(e).$promise}function c(e){return e.body||e.body.id?l().update({id:e.body.id},e.body).$promise:n.error("id is a required parameter")}function i(e){return l().delete({id:e.id}).$promise}function u(e){return l().list(e&&e.searchTerm?{searchTerm:e.searchTerm}:null).$promise.then(function(e){return e.list})}function d(r){return t.post(e+"/giftcards/purchase/"+r.orderid,{},{headers:{"oc-token":a.GetToken()}})}function s(r){return t.post(e+"/giftcards/release/"+r.orderid,{},{headers:{"oc-token":a.GetToken()}})}function l(){var n={create:{method:"POST"},update:{method:"PUT"},"delete":{method:"DELETE"},list:{method:"GET"}};return _.each(n,function(e){e.headers={"oc-token":a.GetToken()}}),r(e+"/giftcards/:id",{},n)}var h={Create:o,Update:c,Delete:i,List:u,Purchase:d,Release:s};return h}function bachmansPurplePerks(e,r,n,t,a){function o(o){var c=new Date,i=n.defer(),u=new Date(c.getFullYear(),3*Math.ceil((c.getMonth()+1)/3),1)-1;return e.post(t+"/"+("test"===a?"Test_BachmansOnPrem":"BachmansOnPrem")+"/PurplePerksBalanceCheck",{card_number:"777777"+o.xp.LoyaltyID}).then(function(e){var n={};e.data&&"cardNumber not available"!=e.data.card_value&&e.data.card_value>0?(n={Balance:Number(e.data.card_value),PointsEarned:e.data.card_value,CardNumber:"777777"+o.xp.LoyaltyID,LoyaltyID:o.xp.LoyaltyID,ExpirationDate:r("date")(u,"MM/dd/yyyy")},i.resolve(n)):(n={Balance:0,PointsEarned:0,CardNumber:"777777"+o.xp.LoyaltyID,LoyaltyID:o.xp.LoyaltyID,ExpirationDate:r("date")(u,"MM/dd/yyyy")},i.resolve(n))}).catch(function(e){console.log(e),i.reject(e)}),i.promise}var c={CheckBalance:o};return c}function bachWiredOrdersService(e){function r(e,r){var i=n(e),u=_.groupBy(i,function(e){return e.xp.Destination});if(u.E&&u.E.length>0){var d,s=_.findWhere(r.Destinations,{Name:"FTD.com"}),l=_.findWhere(r.Destinations,{Name:"Teleflora.com"}),h=_.without(_.keys(u),"E");if(0===h.length)return d=t(s.OrderPercentage,l.OrderPercentage),a(e,d);if(1===h.length)return d=h[0],a(e,d);var m=s.OrderPercentage>l.OrderPercentage?s:l,p="F"===m.Type?l:s,f=o(u.E),y=o(u[m.Type]),P=o(u[p.Type]);return f+y>=m.MinOrderPrice?c(u.E,y,m).then(function(e){var r=o(e);return r+P>=p.MinOrderPrice?c(e,P,p).then(function(e){_.each(e,function(e){return d=t(s.OrderPercentage,l.OrderPercentage),a([e],d)})}):(d=m.Type,a(e,d))}):f+P>=p.MinOrderPrice?c(u.E,P,p).then(function(e){return e?(d=p.Type,a(e,d)):void 0}):(d=t(s.OrderPercentage,l.OrderPercentage),a(u.E,m.Type))}}function n(e){return e=angular.copy(e),_.each(e,function(e){var r=["F","T","E"];_.contains(r,e.Product.xp.CodeB4)&&"Y"===e.Product.xp.CodeB2&&"LocalDelivery"!==e.xp.DeliveryMethod?(e.xp.deliveryCharges=0,"F"===e.Product.xp.CodeB4&&(e.xp.Destination="FTD"),"T"===e.Product.xp.CodeB4&&(e.xp.Destination="TFE"),"E"===e.Product.xp.CodeB4&&(e.xp.Destination="E"),e.xp.Status="OnHold"):e.xp.Destination&&delete e.xp.Destination}),e}function t(e,r){var n,t=100*Math.random();return n=e&&r?r>e?t>=0&&e>=t?"F":"T":t>=0&&r>=t?"T":"F":!e&&r?"T":!r&&e?"F":t>50?"F":"T"}function a(e,r){_.each(e,function(e){e.xp.Destination=r})}function o(e){var r=_.pluck(e,"LineTotal");return _.reduce(r,function(e,r){return e+r},0)}function c(r,n,t){if(n>=t.MinOrderPrice)return e.when(r);var o=r.shift();return n+=o,a([o],t.Type),c(r,n,t.MinOrderPrice)}var i={DetermineEithers:r};return i}angular.module("bachmans-common",[]),OrderCloudSDKBuyerXP.$inject=["$provide"],angular.module("bachmans-common").config(OrderCloudSDKBuyerXP),bachAssignments.$inject=["nodeapiurl","$resource","OrderCloudSDK"],angular.module("bachmans-common").factory("bachAssignments",bachAssignments),bachGiftCards.$inject=["nodeapiurl","$resource","toastr","$http","OrderCloudSDK"],angular.module("bachmans-common").factory("bachGiftCards",bachGiftCards),bachmansPurplePerks.$inject=["$http","$filter","$q","JitterBitBaseUrl","environment"],angular.module("bachmans-common").factory("bachPP",bachmansPurplePerks),bachWiredOrdersService.$inject=["$q"],angular.module("bachmans-common").factory("bachWiredOrders",bachWiredOrdersService);